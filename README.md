# 麻将训练系统

为了大家能在春节麻将先人一步，讨好丈母娘成为一代雀圣。
本项目不提供任何算法作弊的方法，意图提高人工智能

一个现代化的麻将牌效率训练工具，帮助麻将爱好者系统性地提高听牌、何切、向听数等核心技能。

## 📖 项目简介

本工具旨在帮助麻将爱好者提高牌效率判断能力，通过不同难度的训练模式，循序渐进地掌握听牌、何切、向听数等核心概念。采用 Apple Design 风格的现代化界面设计，提供流畅的训练体验。

### 为什么需要训练？

牌效率是麻将技术的基础，通过系统训练可以：
- 🎯 **提高读牌速度** - 快速识别牌型和待牌
- 🧠 **优化打牌选择** - 学会在复杂局面下做出最优决策
- 📈 **增强实战表现** - 将理论知识转化为实战能力

## ✨ 功能特性

### 🎮 训练模块

1. **记牌训练** - 训练记忆场上已出现的牌，判断剩余牌数
2. **听牌训练** - 快速识别听牌形态和待牌
3. **何切训练** - 学习在14张牌情况下选择最优切牌
4. **向听数训练** - 训练快速计算手牌的向听数
5. **一向听训练** - 识别一向听牌型，找出所有有效牌
6. **牌型分析** - 综合分析工具，输入任意手牌获得详细评估
7. **连连看** - 点击四个相同的牌来消除，训练反应速度和牌型识别能力

### 🎨 设计特点

- **Apple Design 风格** - 简洁优雅的现代化界面
- **响应式设计** - 完美适配手机竖屏和桌面端
- **流畅动画** - 细腻的交互动画和过渡效果
- **本地存储** - 成绩自动保存，支持排行榜功能

## 🚀 快速开始

### 使用方式

这是一个纯前端网页应用，由于使用了 ES6 模块，**必须通过 HTTP 服务器运行**，不能直接双击打开 HTML 文件。

**本地服务器（必须）**

1. **使用 Python（推荐）**
   
   在项目根目录下打开终端/命令行，运行：
   ```bash
   # Python 3
   python -m http.server 8000
   
   # 或 Windows 用户可以直接双击 启动服务器.bat 文件
   ```
   
   然后在浏览器访问：
   ```
   http://localhost:8000
   ```
   
2. **使用 Node.js**
   ```bash
   npx http-server
   ```
   
   然后在浏览器访问显示的地址（通常是 http://localhost:8080）

3. **Windows 用户快速启动**
   - 双击项目根目录下的 `启动服务器.bat` 文件
   - 等待服务器启动后，在浏览器访问 http://localhost:8000

3. **部署到服务器**
   
   将整个项目文件夹上传到任何静态网站托管服务（如 GitHub Pages、Netlify、Vercel 等）即可。

## 📁 项目结构

```
Mahjong/
├── index.html              # 主入口页面
├── css/                    # 样式文件
│   ├── common.css         # 通用样式
│   ├── components.css     # 组件样式
│   └── trainers.css       # 训练模块样式
├── js/                     # JavaScript 代码
│   ├── main.js            # 主入口，路由和模式切换
│   ├── utils/             # 工具函数库
│   │   ├── tile-utils.js  # 麻将牌工具函数
│   │   ├── storage.js     # localStorage 封装
│   │   └── timer.js       # 计时器工具
│   ├── trainers/          # 训练模块
│   │   ├── memory-trainer.js      # 记牌训练
│   │   ├── tenpai-trainer.js      # 听牌训练
│   │   ├── heqie-trainer.js       # 何切训练
│   │   ├── shanten-trainer.js     # 向听数训练
│   │   ├── one-shanten-trainer.js # 一向听训练
│   │   ├── analysis.js            # 牌型分析
│   │   └── match-trainer.js        # 连连看
│   └── components/        # 可复用组件
│       ├── tile-display.js   # 麻将牌展示组件
│       ├── leaderboard.js    # 排行榜组件
│       └── config-panel.js   # 配置面板组件
├── svg_materials/         # SVG 资源文件
│   ├── tong*.svg         # 筒子牌
│   ├── tiao*.svg         # 条子牌
│   ├── wan*.svg          # 万子牌
│   └── ...               # 其他牌
├── export_svg_from_md.py # SVG 导出工具（可选）
└── README.md             # 项目说明文档
```

## 🎯 使用指南

### 通用设置

在开始训练之前，您可以根据自己的水平调整以下参数：

- **牌数选择** - 根据训练模式不同，可选择 13 张牌或 14 张牌模式
- **难度级别** - 从简单到困难，不同难度会影响手牌的复杂程度
- **倒计时** - 可以设置答题时间限制，模拟实战压力

### 快捷键操作

- `1-9` - 快速选择对应数字的牌
- `Enter` - 确认提交答案

### 训练模式说明

#### 记牌训练

训练记忆场上已出现的牌，判断剩余牌数。这是基础训练，帮助提高对牌堆的感知能力。

##### 功能需求

**核心功能：**
- 系统随机生成场上已出现的牌，显示在界面上
- 用户需要在限定时间内记忆这些牌
- 根据记忆填写每种牌还剩几张（每种牌总共 4 张）
- 提交答案后查看结果和详细分析

**牌种说明：**
- **万子牌**：一万至九万（共 9 种，每种 4 张）
- **筒子牌**：一筒至九筒（共 9 种，每种 4 张）
- **条子牌**：一条至九条（共 9 种，每种 4 张）
- **字牌**：东、南、西、北、白、发、中（共 7 种，每种 4 张）
- 总计 34 种牌，每种牌在牌堆中都有 4 张

**操作方式：**

1. **记忆阶段界面**
   - 系统显示场上已出现的牌
   - 显示倒计时，提醒剩余记忆时间
   - 可以反复查看已出现的牌（训练模式）
   - 记忆时间结束后自动跳转到答题界面

2. **答题界面布局**
   - **界面铺满设计**：根据选择的牌型种类，界面铺满显示所有需要记忆的牌型
     - **一种牌型**：显示该牌型的所有牌种（如万子：一万到九万，共9个牌种）
     - **两种牌型**：分区域显示两种牌型的所有牌种
     - **三种牌型**：分区域显示三种牌型的所有牌种
     - **全部牌型**：分区域显示四种牌型（万子、筒子、条子、字牌）
   - **牌型分组显示**：按牌型类别分组，每组用标题区分（如"万子牌"、"筒子牌"等）
   - **每个牌种显示**：
     - 显示牌种的图标/名称
     - 显示当前输入的剩余数量（0-4）
     - 高亮显示已输入数量的牌种
     - 未输入的牌种显示为待填写状态

3. **交互方式**
   - **鼠标操作**：
     - **左键点击牌种**：增加剩余数量（0 → 1 → 2 → 3 → 4 → 0 循环）
     - **右键点击牌种**：减少剩余数量（4 → 3 → 2 → 1 → 0 → 4 循环）
     - **点击提交按钮**：提交答案
   - **键盘操作**：
     - **Tab / 方向键**：切换选中的牌种（高亮显示当前选中）
     - **数字键 1-9**：为当前选中的牌种快速输入对应数量（按一次计一次）
     - **数字键 0**：将当前选中的牌种设置为 0 张剩余
     - **Enter**：提交答案（或点击提交按钮）
     - **Esc**：重置当前选中的牌种为 0
     - **Backspace**：清空当前选中的牌种
   - **批量操作**（可选）：
     - **Ctrl + 左键**：多选多个牌种，统一设置数量
     - **Shift + 左键**：选择连续范围的牌种

4. **视觉反馈**
   - **数量显示**：每个牌种下方/旁边显示当前输入的剩余数量（0-4）
   - **状态指示**：
     - 未输入：灰色/半透明显示
     - 已输入：正常颜色显示，数量用数字标识
     - 当前选中：高亮边框或背景色突出显示
   - **进度提示**：显示已填写的牌种数量 / 总牌种数量
   - **时间显示**：答题界面顶部显示剩余答题时间（挑战模式）

5. **时间设置**
   - 可自定义调整记忆时间（5-360 秒）
   - 支持不同难度级别预设时间
   - 实时显示剩余时间倒计时

6. **模式选择**
   - **训练模式**：
     - 无时间限制
     - 可以反复查看和记忆已出现的牌
     - 适合初学者和日常练习
     - 提供提示和辅助功能
   - **挑战模式**：
     - 严格计时，时间到自动提交
     - 记忆阶段结束后隐藏已出现的牌
     - 模拟实战压力环境
     - 适合进阶训练和水平测试
     - 记录成绩和排行榜

##### 训练配置

**牌型种类设置：**
- **一种牌型** - 只训练单一牌型（万子/筒子/条子/字牌任选其一）
- **两种牌型** - 训练两种牌型组合（如万子+筒子、条子+字牌等）
- **三种牌型** - 训练三种牌型组合（如万子+筒子+条子等）
- **全部牌型** - 训练所有四种牌型（万子+筒子+条子+字牌），难度最高

**难度级别：**
- **简单** - 出现牌数较少（10-15 张），记忆时间充足（30-60 秒）
- **中等** - 出现牌数适中（15-25 张），记忆时间适中（20-40 秒）
- **困难** - 出现牌数较多（25-35 张），记忆时间紧张（10-20 秒）
- **专家** - 出现牌数很多（35-45 张），记忆时间极短（5-10 秒）

**组合说明：**
训练难度 = 牌型种类数量 × 难度级别
- 例如：一种牌型 + 简单难度 = 最容易
- 例如：全部牌型 + 专家难度 = 最困难

**评分标准：**
- **完全正确**：所有牌种剩余数量都准确 → 满分（100 分）
- **部分正确**：部分牌种准确 → 按准确率计算得分（准确率 × 100）
- **时间奖励**：在规定时间内完成可获得额外加分（剩余时间 × 系数）
- **连续正确**：连续答对可获得连击奖励（连击数 × 额外分数）
- **错误惩罚**：每错一种牌扣除相应分数

##### 训练指导

**训练步骤：**
1. 选择训练模式（训练模式/挑战模式）
2. 选择牌型种类（一种/两种/三种/全部）
3. 选择难度级别（简单/中等/困难/专家）
4. 设置记忆时间（可选，或使用预设时间）
5. **记忆阶段**：观察并记忆场上已出现的牌
   - 系统显示已出现的牌，开始倒计时
   - 在限定时间内记忆所有牌种的出现数量
   - 记忆时间结束后自动跳转到答题界面
6. **答题阶段**：在答题界面填写每种牌的剩余数量
   - 界面铺满显示所有需要记忆的牌型
   - 使用鼠标或键盘为每个牌种输入剩余数量（0-4）
   - 可以随时修改已输入的数量
   - 检查确认所有牌种都已填写（可选提示）
7. **提交答案**：点击提交按钮或按 Enter 键
8. **查看结果**：查看详细分析和成绩
   - 显示正确答案和您的答案对比
   - 显示准确率和得分
   - 显示错误分析和改进建议
9. 根据分析结果调整训练策略，继续下一轮训练

**训练技巧：**

- **分组记忆** - 按牌种（万、筒、条、字牌）分组记忆，提高效率
- **数量估算** - 先估算大致数量，再精确记忆具体牌种
- **关联记忆** - 利用牌的组合关系（如顺子、刻子）辅助记忆
- **重点标记** - 优先记忆出现次数多的牌种，这些更容易出错
- **系统化方法** - 按照固定顺序（如从一万到九万，再到筒、条、字牌）记忆

**常见错误分析：**
- **数量偏差** - 对某些牌种的数量判断不准确，需要加强该牌种的记忆训练
- **遗漏牌种** - 忘记某些已出现的牌种，建议采用系统化的记忆方法
- **时间不足** - 记忆时间不够导致遗漏，可适当降低难度或延长记忆时间
- **混淆牌种** - 将不同牌种的数量记混，需要加强牌种识别训练

**进阶建议：**
- **初学者**：从简单难度、训练模式开始，逐步提高记忆速度和准确性
- **中级玩家**：挑战中等难度，重点训练快速记忆能力，尝试挑战模式
- **高级玩家**：尝试困难或专家难度，模拟实战中的快速记牌场景
- **训练频率**：建议每天训练 10-20 分钟，保持记忆能力的持续提升
- **记录追踪**：定期查看成绩记录，分析薄弱环节，针对性加强训练





#### 听牌训练

听牌训练帮助您快速识别听牌形态和待牌。这是牌效率训练的基础，掌握听牌识别是提高麻将水平的关键。

**训练步骤：**
1. 系统随机生成一手听牌的 7 10 13 张牌
2. 观察手牌，判断待牌
3. 点击或使用快捷键选择待牌（待选牌为灰色）  
4. 提交答案查看结果

##### 听牌种类

听牌是麻将中非常重要的概念，指手牌距离和牌只差一张牌的状态。根据待牌的数量和位置，听牌可以分为多种类型：

**1. 两面听（双面听）**

最常见的听牌类型，待牌为连续数字的两端。

**示例：** 待 4筒 或 7筒
- 手牌：m123, m456, m789（3个顺子），s88（对子），p56（搭子）
- 分解：p56 是两面搭子，听 4筒 和 7筒
- 特点：待牌数量为 2 张，和牌概率较高

**2. 单骑听（单吊）**

只待一张特定的牌，通常是对子中的一张。

**示例：** 待 9筒
- 手牌：m111, m222, m333（3个刻子），p123（顺子），p9（单张）
- 分解：p9 是单张，需要再摸一张 9筒 组成对子
- 特点：待牌数量为 1 张，和牌概率较低，但容易改听

**3. 三面听**

待牌为三张连续的牌，通常由特殊牌型组成。

**示例：** 待 1万、4万 或 7万
- 手牌：m23456（五连张），p123, s123（2个顺子），p99（对子）
- 分解：
  - m234 + m56（搭子，听 4、7）
  - m23 + m456（搭子，听 1、4）
  - 综合听 1、4、7 三张
- 特点：待牌数量为 3 张，和牌概率很高

**4. 嵌张听（坎张听）**

待牌为两张连续数字中间的那张牌。

**示例：** 待 5筒
- 手牌：m123, m456, m789（3个顺子），s88（对子），p46（嵌张搭子）
- 分解：p46 是嵌张搭子，听中间的 5筒
- 特点：待牌数量为 1 张，和牌概率较低

**5. 边张听**

待牌为顺子的边张（1 或 9）。

**示例：** 待 3筒
- 手牌：m123, m456, m789（3个顺子），s88（对子），p12（边张搭子）
- 分解：p12 是边张搭子，听 3筒
- 特点：待牌数量为 1 张，和牌概率较低

**6. 双碰听（对倒听）**

待牌为两个对子中的任意一张。

**示例：** 待 5筒 或 8条
- 手牌：m123, m456, m789（3个顺子），p55（对子），s88（对子）
- 分解：p55 和 s88 两个对子，听 5筒 或 8条
- 特点：待牌数量为 2 张，但每种只有 2 张剩余，实际和牌概率与两面听相当

##### 训练技巧

- **从简单开始** - 建议从简单难度开始，先熟悉常见听牌形态（两面听、单骑听）
- **识别牌型** - 注意区分两面听、嵌张听、边张听、单骑听、双碰听等不同听牌类型
- **逐步提高** - 逐步提高难度，挑战复杂牌型（三面听、多面听）
- **快速判断** - 多练习可以提高识别速度，在实战中更快做出判断
- **牌型分解** - 学会将手牌分解为顺子、刻子、对子、搭子，快速识别听牌形态

#### 何切训练

学习在 14 张牌的情况下，选择最优的切牌方案。这是实战中最常用的技能之一。
练习每一打的切牌选择（何切）。通过科学的进张数分析，掌握最大机率的打法，提升牌效。

**训练步骤：**
1. 系统生成 14 张牌
2. 分析手牌，找出应该打出的牌
3. 选择要切的牌
4. 查看正确答案和解析

#### 向听数训练

训练快速计算手牌的向听数。向听数是判断手牌好坏的重要指标，向听数越小，距离和牌越近。

**训练步骤：**
1. 观察手牌
2. 计算距离听牌还差几步
3. 输入向听数
4. 查看答案

#### 一向听训练

识别距离听牌只差一步的牌型，并找出所有能让手牌进入听牌的有效牌。

**训练步骤：**
1. 观察 13 张牌
2. 判断有效牌（能让手牌进入听牌的牌）
3. 选择所有有效牌
4. 提交答案

#### 牌型分析

综合分析工具，输入任意手牌获得详细的牌效率评估。

**使用方法：**
1. 输入或选择手牌（支持 13 张或 14 张牌）
2. 点击分析按钮
3. 查看详细的分析结果

**分析内容包括：**
- 向听数：当前手牌距离听牌还差几步
- 有效牌：能让向听数减少的所有牌种及数量
- 推荐切牌：在 14 张牌模式下，分析每种切牌方案的效果
- 听牌信息：如果已听牌，显示所有待牌
- 牌型评估：手牌的整体效率和改进建议

#### 连连看

通过点击四个相同的牌来消除，训练反应速度和牌型识别能力。这是一个轻松有趣的训练模式，在游戏中提高对麻将牌的熟悉程度。

**游戏规则：**
- 游戏界面为 16 列 n 行的网格布局（每行16个牌）
- 随机生成各种麻将牌
- 点击四个相同的牌即可消除
- 消除所有牌即可获胜
- 支持计时和排名功能

**训练步骤：**
1. 选择游戏模式（训练模式/挑战模式）
2. 选择难度级别（简单/中等/困难/专家）
3. 观察网格中的牌，找出四个相同的牌
4. 依次点击四个相同的牌进行消除
5. 继续消除，直到所有牌都被消除
6. 查看完成时间和得分

##### 难度级别

**简单难度：**
- 牌型：包含筒子、条子、万字和所有字牌（东、南、西、北、白、发、中）
- 网格：4 行 × 16 列 = 64 张牌
- 牌种：16 种不同的牌，每种 4 张（包含7种字牌）
- 适合：初学者，熟悉基本牌型和字牌

**中等难度：**
- 牌型：包含筒子、条子、万字和所有字牌（东、南、西、北、白、发、中）
- 网格：5 行 × 16 列 = 80 张牌
- 牌种：20 种不同的牌，每种 4 张（包含7种字牌）
- 适合：有一定基础的玩家

**困难难度：**
- 牌型：包含筒子、条子、万字和所有字牌（东、南、西、北、白、发、中）
- 网格：6 行 × 16 列 = 96 张牌
- 牌种：24 种不同的牌，每种 4 张（包含7种字牌）
- 适合：进阶玩家，提高识别速度

**专家难度：**
- 牌型：包含所有牌型（筒、条、万、字牌：东、南、西、北、白、发、中）
- 网格：7 行 × 16 列 = 112 张牌
- 牌种：28 种不同的牌，每种 4 张（包含7种字牌）
- 适合：高级玩家，挑战极限速度

##### 游戏模式

**训练模式：**
- 无时间压力，可以慢慢思考
- 适合熟悉游戏规则和牌型
- 可以随时重新开始
- 不记录成绩到排行榜

**挑战模式：**
- 计时模式，追求最快完成时间
- 成绩自动保存到排行榜
- 可以查看历史最佳成绩
- 适合挑战自我和竞争

##### 得分系统

得分计算公式：
- 基础分数：1000 分
- 时间奖励：300 秒 - 实际用时（秒），时间越短奖励越高
- 难度系数：
  - 简单：1.0 倍
  - 中等：1.5 倍
  - 困难：2.0 倍
  - 专家：3.0 倍

最终得分 = (基础分数 + 时间奖励) × 难度系数

##### 排行榜功能

- 自动记录挑战模式的成绩
- 按得分从高到低排序
- 显示用时、难度、日期等信息
- 保留历史前 10 名记录
- 可以随时查看排行榜

##### 训练技巧

**快速识别：**
- 先快速扫描整个网格，找出出现次数多的牌型
- 优先消除容易找到的牌组
- 注意观察牌的分布位置

**策略建议：**
- 从边缘开始，逐步向中心消除
- 避免同时选中多个不同的牌
- 保持冷静，不要急躁

**进阶训练：**
- 尝试不看牌面，仅凭位置记忆
- 挑战最短完成时间
- 在不同难度间切换，提高适应性

##### 功能特点

- **16 列布局**：固定 16 列（每行16个牌），行数根据难度调整（4-7 行）
- **全部牌型**：支持所有麻将牌型（筒、条、万、字牌）
- **随机生成**：每次游戏牌的位置都不同，增加挑战性
- **计时功能**：实时显示游戏用时
- **进度显示**：显示已消除牌数和总牌数
- **排名系统**：记录最佳成绩，支持查看排行榜
- **响应式设计**：适配不同屏幕尺寸

## 🛠️ 技术栈

- **前端框架** - 纯原生 JavaScript (ES6+)
- **样式** - CSS3 (Apple Design 风格)
- **存储** - localStorage (本地数据持久化)
- **资源** - SVG 矢量图形

## 📝 开发说明

### 环境要求

- 现代浏览器（Chrome、Firefox、Safari、Edge 等）
- 支持 ES6+ 模块的浏览器
- 无需 Node.js 或任何构建工具

### 添加新的训练模块

1. 在 `js/trainers/` 目录下创建新的训练器文件
2. 实现标准的训练器接口：
   ```javascript
   export default {
     async init(container) {
       // 初始化训练器
     },
     onShow() {
       // 显示时的回调
     }
   };
   ```
3. 在 `js/main.js` 中注册新模块
4. 在 `index.html` 中添加导航按钮

### SVG 资源管理

项目包含一个 Python 脚本 `export_svg_from_md.py`，用于从 Markdown 文件中导出 SVG 资源。如需添加新的牌型资源，可以：

1. 在对应的 Markdown 文件中添加 SVG 内容
2. 运行脚本导出：
   ```bash
   python export_svg_from_md.py
   ```

## 📊 功能路线图

- [x] 基础架构和 UI 设计
- [x] 记牌训练模块
- [x] 听牌训练模块
- [x] 何切训练模块
- [x] 向听数训练模块
- [x] 一向听训练模块
- [x] 牌型分析工具
- [x] 连连看游戏
- [ ] 深色模式支持
- [ ] 多语言支持
- [ ] 数据导出功能

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

本项目采用 MIT 许可证。

## 🙏 致谢

感谢所有为麻将技术发展做出贡献的社区和开发者。

---

**开始训练，提升你的麻将水平！** 🀄️


